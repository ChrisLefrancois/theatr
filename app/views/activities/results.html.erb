<div class="container">
  <h1 class="text-center mt-3"><%= @activity.title %></h1>
  <h3 class="text-center mt-3">Level: <%= @activity.level %></h3>
  <% if !@activity.badges.find_by(user: current_user).unavailable? %>
    <div>
      <%# get all activities questions %>
      <% @activity_questions.each do |question| %>
        <div class="question">
          <h4><%= question.question_text %></h4>
          <%# Submit a response to each question ONLY if no response is already present %>
          <%# to prevent multiple responses to 1 question %>
          <% if question.user_responses.where(user: @profile).empty? && !current_user.teacher? %>
            <%= simple_form_for([question, @user_response]) do |f| %>
              <%# If it's a review, the input field is a text field %>
              <% if question.activity.activity_type == "Review" %>
                <%= f.input :text, as: :text, label: false %>
              <% else %>
                <%= f.input :text, label: false, placeholder: "Write your answer..." %>
              <% end %>
              <%= f.hidden_field :activity_question_id, value: question.id %>
              <%= f.submit "Save Answer", class: "btn btn-primary" %>
            <% end %>
          <% end %>

          <%# get the response where the user is the @profile(params) %>
          <% question.user_responses.where(user: @profile).each do |response| %>
            <%= render 'activities/user_responses_info', question: question, response: response %>

            <% if current_user.teacher? %>
              <%= simple_form_for([response, @teacher_comment]) do |f| %>
                <%= f.input :text, label: false, placeholder: "Leave a comment..." %>
                <%= f.hidden_field :user_response_id, value: response.id %>
                <%= f.submit "Save Comment", class: "btn btn-primary" %>
              <% end %>
            <% end %>

            <%# find the teacher comment for this user_response %>
            <% TeacherComment.where(user_response: response).each do |comment| %>
              <p class="align-self-end"><%= comment.text %> - <em><%= "#{comment.teacher.first_name} #{comment.teacher.last_name}" %></em> </p>
            <% end %>
          <% end %>
        </div>
      <% end %>
    </div>
  <% else %>
    <h3>You can't complete this activity yet!</h3>
  <% end %>

  <br>
  <p class="text-center"><%= link_to "Back to activities", activities_path, class: "text-decoration-none" %></p>
</div>
